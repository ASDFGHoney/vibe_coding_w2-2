name: Issue Comment

on:
  issues:
    types: [opened, reopened, labeled]

jobs:
  issue-comment:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    
    steps:
    - name: Welcome comment for new issues
      if: github.event.action == 'opened'
      uses: actions/github-script@v7
      with:
        script: |
          const issue = context.payload.issue;
          const author = issue.user.login;
          const title = issue.title;
          const body = issue.body || '';
          
          // ì´ìŠˆ íƒ€ì… ë¶„ì„
          let issueType = 'general';
          if (title.toLowerCase().includes('[bug]') || title.toLowerCase().includes('bug')) {
            issueType = 'bug';
          } else if (title.toLowerCase().includes('[feature]') || title.toLowerCase().includes('feature')) {
            issueType = 'feature';
          } else if (title.toLowerCase().includes('[question]') || title.toLowerCase().includes('question')) {
            issueType = 'question';
          } else if (title.toLowerCase().includes('[enhancement]') || title.toLowerCase().includes('enhancement')) {
            issueType = 'enhancement';
          }
          
          // íƒ€ì…ë³„ í™˜ì˜ ë©”ì‹œì§€
          let welcomeMessage;
          switch (issueType) {
            case 'bug':
              welcomeMessage = `## ğŸ› ë²„ê·¸ ì‹ ê³  ê°ì‚¬í•©ë‹ˆë‹¤!

              ì•ˆë…•í•˜ì„¸ìš” @${author}ë‹˜! ë²„ê·¸ ì‹ ê³ í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

              **ğŸ“‹ ë²„ê·¸ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤:**
              1. ğŸ” ì´ìŠˆ ë‚´ìš© ê²€í† 
              2. ğŸ·ï¸ ìš°ì„ ìˆœìœ„ ë¼ë²¨ í• ë‹¹
              3. ğŸ‘¥ ë‹´ë‹¹ì ë°°ì •
              4. ğŸ§ª ì¬í˜„ ë° ë¶„ì„
              5. ğŸ”§ ìˆ˜ì • ì‘ì—…
              6. âœ… í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

              **â° ì˜ˆìƒ ì²˜ë¦¬ ì‹œê°„:**
              - ê¸´ê¸‰ ë²„ê·¸: 24ì‹œê°„ ì´ë‚´
              - ì¼ë°˜ ë²„ê·¸: 3-5ì¼
              - ë§ˆì´ë„ˆ ë²„ê·¸: 1-2ì£¼

              **ğŸ“ ì¶”ê°€ ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš° ëŒ“ê¸€ë¡œ ë¬¸ì˜ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**`;
              break;
              
            case 'feature':
              welcomeMessage = `## âœ¨ ê¸°ëŠ¥ ìš”ì²­ ê°ì‚¬í•©ë‹ˆë‹¤!

              ì•ˆë…•í•˜ì„¸ìš” @${author}ë‹˜! ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì œì•ˆí•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

              **ğŸ“‹ ê¸°ëŠ¥ ìš”ì²­ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤:**
              1. ğŸ“ ìš”êµ¬ì‚¬í•­ ë¶„ì„
              2. ğŸ¯ ìš°ì„ ìˆœìœ„ í‰ê°€
              3. ğŸ“Š ê¸°ìˆ ì  ê²€í† 
              4. ğŸ—³ï¸ íŒ€ ë‚´ ë…¼ì˜
              5. ğŸ“… ê°œë°œ ì¼ì • ìˆ˜ë¦½
              6. ğŸš€ êµ¬í˜„ ì‹œì‘

              **ğŸ’¡ ê²€í†  ê¸°ì¤€:**
              - ì‚¬ìš©ì ê°€ì¹˜
              - ê¸°ìˆ ì  ì‹¤í˜„ ê°€ëŠ¥ì„±
              - ë¦¬ì†ŒìŠ¤ ìš”êµ¬ì‚¬í•­
              - ê¸°ì¡´ ê¸°ëŠ¥ê³¼ì˜ í˜¸í™˜ì„±

              **ğŸ“Š ê¸°ëŠ¥ ìš”ì²­ì€ ì •ê¸°ì ìœ¼ë¡œ ê²€í† ë˜ë©°, ê²°ê³¼ë¥¼ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤.**`;
              break;
              
            case 'question':
              welcomeMessage = `## â“ ì§ˆë¬¸ ê°ì‚¬í•©ë‹ˆë‹¤!

              ì•ˆë…•í•˜ì„¸ìš” @${author}ë‹˜! ì§ˆë¬¸í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

              **ğŸ” ì§ˆë¬¸ ë‹µë³€ í”„ë¡œì„¸ìŠ¤:**
              1. ğŸ“– ë¬¸ì„œ í™•ì¸
              2. ğŸ§  íŒ€ ë‚´ ê²€í† 
              3. ğŸ’¬ ìƒì„¸ ë‹µë³€ ì œê³µ
              4. ğŸ“š ë¬¸ì„œ ì—…ë°ì´íŠ¸ (í•„ìš”ì‹œ)

              **âš¡ ë¹ ë¥¸ ë‹µë³€ì„ ìœ„í•œ íŒ:**
              - êµ¬ì²´ì ì¸ ìƒí™© ì„¤ëª…
              - ì—ëŸ¬ ë©”ì‹œì§€ ì²¨ë¶€
              - í™˜ê²½ ì •ë³´ ì œê³µ
              - ê¸°ëŒ€í•˜ëŠ” ê²°ê³¼ ëª…ì‹œ

              **ğŸ“ ì¶”ê°€ ì§ˆë¬¸ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ëŒ“ê¸€ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”!**`;
              break;
              
            default:
              welcomeMessage = `## ğŸ‘‹ ì´ìŠˆ ë“±ë¡ ê°ì‚¬í•©ë‹ˆë‹¤!

              ì•ˆë…•í•˜ì„¸ìš” @${author}ë‹˜! ì´ìŠˆë¥¼ ë“±ë¡í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

              **ğŸ“‹ ì´ìŠˆ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤:**
              1. ğŸ” ë‚´ìš© ê²€í†  ë° ë¶„ë¥˜
              2. ğŸ·ï¸ ì ì ˆí•œ ë¼ë²¨ í• ë‹¹
              3. ğŸ‘¥ ë‹´ë‹¹ì ë°°ì •
              4. ğŸ“… ì¼ì • ìˆ˜ë¦½
              5. ğŸš€ ì‘ì—… ì§„í–‰
              6. âœ… ì™„ë£Œ ë° ê²€ì¦

              **â° ì¼ë°˜ì ì¸ ì²˜ë¦¬ ì‹œê°„:**
              - ê¸´ê¸‰ ì´ìŠˆ: 24ì‹œê°„ ì´ë‚´
              - ì¼ë°˜ ì´ìŠˆ: 3-7ì¼
              - ê°œì„  ì‚¬í•­: 1-2ì£¼

              **ğŸ“ ì¶”ê°€ ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš° ëŒ“ê¸€ë¡œ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.**`;
          }
          
          // ì²´í¬ë¦¬ìŠ¤íŠ¸ í™•ì¸
          const hasDescription = body.length > 20;
          const hasSteps = body.toLowerCase().includes('ë‹¨ê³„') || body.toLowerCase().includes('step');
          const hasExpected = body.toLowerCase().includes('ì˜ˆìƒ') || body.toLowerCase().includes('expected');
          
          const checklistComment = `
          **ğŸ“‹ ì´ìŠˆ í’ˆì§ˆ ì²´í¬:**
          - [${hasDescription ? 'x' : ' '}] ì¶©ë¶„í•œ ì„¤ëª… ì œê³µ
          - [${hasSteps ? 'x' : ' '}] ì¬í˜„ ë‹¨ê³„ í¬í•¨ (ë²„ê·¸ì˜ ê²½ìš°)
          - [${hasExpected ? 'x' : ' '}] ì˜ˆìƒ ê²°ê³¼ ëª…ì‹œ
          - [${title.length > 10 ? 'x' : ' '}] ëª…í™•í•œ ì œëª©

          ${!hasDescription ? 'ğŸ’¡ **ê°œì„  ì œì•ˆ**: ë” ìì„¸í•œ ì„¤ëª…ì„ ì¶”ê°€í•´ì£¼ì‹œë©´ ë” ë¹ ë¥¸ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n' : ''}
          ${issueType === 'bug' && !hasSteps ? 'ğŸ’¡ **ê°œì„  ì œì•ˆ**: ë²„ê·¸ ì¬í˜„ ë‹¨ê³„ë¥¼ ì¶”ê°€í•´ì£¼ì‹œë©´ ë””ë²„ê¹…ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.\n' : ''}`;

          const fullComment = welcomeMessage + '\n\n' + checklistComment + `

          ---
          *ì´ ëŒ“ê¸€ì€ GitHub Actionsì— ì˜í•´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ê³§ ë‹´ë‹¹ìê°€ ê²€í† í•  ì˜ˆì •ì…ë‹ˆë‹¤.*`;

          await github.rest.issues.createComment({
            issue_number: issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: fullComment
          });

  issue-status-update:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    if: github.event.action == 'labeled'
    
    steps:
    - name: Status update comment
      uses: actions/github-script@v7
      with:
        script: |
          const issue = context.payload.issue;
          const label = context.payload.label;
          
          let statusMessage = '';
          
          switch (label.name) {
            case 'bug':
              statusMessage = `ğŸ› **ë²„ê·¸ ë¼ë²¨ì´ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.**
              
              ì´ ì´ìŠˆëŠ” ë²„ê·¸ë¡œ ë¶„ë¥˜ë˜ì–´ ë†’ì€ ìš°ì„ ìˆœìœ„ë¡œ ì²˜ë¦¬ë  ì˜ˆì •ì…ë‹ˆë‹¤.
              ë‹´ë‹¹ ê°œë°œìê°€ ê³§ í• ë‹¹ë  ì˜ˆì •ì…ë‹ˆë‹¤.`;
              break;
              
            case 'feature':
              statusMessage = `âœ¨ **ê¸°ëŠ¥ ìš”ì²­ ë¼ë²¨ì´ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.**
              
              ì´ ê¸°ëŠ¥ ìš”ì²­ì€ ì œí’ˆ íŒ€ì—ì„œ ê²€í†  í›„ ìš°ì„ ìˆœìœ„ë¥¼ ê²°ì •í•  ì˜ˆì •ì…ë‹ˆë‹¤.
              ê²€í†  ê²°ê³¼ëŠ” 1-2ì£¼ ë‚´ì— ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤.`;
              break;
              
            case 'urgent':
              statusMessage = `ğŸš¨ **ê¸´ê¸‰ ì´ìŠˆë¡œ ë¶„ë¥˜ë˜ì—ˆìŠµë‹ˆë‹¤.**
              
              ì´ ì´ìŠˆëŠ” ìµœìš°ì„ ìœ¼ë¡œ ì²˜ë¦¬ë  ì˜ˆì •ì…ë‹ˆë‹¤.
              24ì‹œê°„ ë‚´ì— ì´ˆê¸° ëŒ€ì‘ì´ ì´ë£¨ì–´ì§ˆ ì˜ˆì •ì…ë‹ˆë‹¤.`;
              break;
              
            case 'help-wanted':
              statusMessage = `ğŸ™‹ **ë„ì›€ì´ í•„ìš”í•œ ì´ìŠˆì…ë‹ˆë‹¤.**
              
              ì»¤ë®¤ë‹ˆí‹° ê¸°ì—¬ë¥¼ í™˜ì˜í•©ë‹ˆë‹¤! 
              ì´ ì´ìŠˆ í•´ê²°ì— ì°¸ì—¬í•˜ê³  ì‹¶ìœ¼ì‹œë©´ ëŒ“ê¸€ë¡œ ì˜ì‚¬ë¥¼ í‘œí˜„í•´ì£¼ì„¸ìš”.`;
              break;
              
            case 'good-first-issue':
              statusMessage = `ğŸŒŸ **ì²« ê¸°ì—¬ì— ì¢‹ì€ ì´ìŠˆì…ë‹ˆë‹¤.**
              
              ì´ ì´ìŠˆëŠ” í”„ë¡œì íŠ¸ì— ì²˜ìŒ ê¸°ì—¬í•˜ëŠ” ë¶„ë“¤ì—ê²Œ ì í•©í•©ë‹ˆë‹¤.
              ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì§ˆë¬¸í•´ì£¼ì„¸ìš”!`;
              break;
              
            case 'wontfix':
              statusMessage = `âŒ **ìˆ˜ì •í•˜ì§€ ì•Šê¸°ë¡œ ê²°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.**
              
              ì´ ì´ìŠˆëŠ” ë‹¤ìŒ ì´ìœ ë¡œ ìˆ˜ì •í•˜ì§€ ì•Šê¸°ë¡œ ê²°ì •ë˜ì—ˆìŠµë‹ˆë‹¤:
              - ì„¤ê³„ ì˜ë„ì™€ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ
              - ëŒ€ì•ˆ í•´ê²°ì±… ì¡´ì¬
              - ê¸°ìˆ ì  ì œì•½ ì‚¬í•­
              
              ìì„¸í•œ ì´ìœ ëŠ” ë‹´ë‹¹ìê°€ ë³„ë„ë¡œ ì„¤ëª…ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤.`;
              break;
              
            case 'duplicate':
              statusMessage = `ğŸ”„ **ì¤‘ë³µ ì´ìŠˆë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.**
              
              ì´ ì´ìŠˆëŠ” ê¸°ì¡´ ì´ìŠˆì™€ ì¤‘ë³µë˜ëŠ” ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.
              ê´€ë ¨ëœ ê¸°ì¡´ ì´ìŠˆ ë§í¬ë¥¼ ê³§ ì œê³µí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.`;
              break;
              
            default:
              // ìš°ì„ ìˆœìœ„ ë¼ë²¨ë“¤
              if (label.name.startsWith('priority:')) {
                const priority = label.name.split(':')[1];
                statusMessage = `ğŸ“Š **ìš°ì„ ìˆœìœ„ê°€ ${priority}ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.**
                
                ì´ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ì²˜ë¦¬ ì¼ì •ì´ ê²°ì •ë©ë‹ˆë‹¤:
                - high: 1-3ì¼ ë‚´ ì‹œì‘
                - medium: 1-2ì£¼ ë‚´ ì‹œì‘  
                - low: ë°±ë¡œê·¸ì—ì„œ ê´€ë¦¬`;
              }
          }
          
          if (statusMessage) {
            await github.rest.issues.createComment({
              issue_number: issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: statusMessage + `\n\n---\n*ë¼ë²¨ ë³€ê²½ì— ë”°ë¥¸ ìë™ ì—…ë°ì´íŠ¸ì…ë‹ˆë‹¤.*`
            });
          } 